<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebTorrent P2P Share (Edit Telegram Message)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>

<style>
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
  padding:14px;
  max-width:720px;
  margin:auto;
  background:#fafafa;
}
h2{font-size:1.4em}
input,button{
  width:100%;
  padding:14px;
  margin:8px 0;
  font-size:1em;
  border-radius:10px;
}
input{border:1px solid #ccc}
button{
  border:none;
  cursor:pointer;
  font-weight:600;
}
.btn-seed{background:#4CAF50;color:#fff}
.btn-copy{background:#2196F3;color:#fff}
.btn-edit{background:#9C27B0;color:#fff}
.btn-download{background:#FF9800;color:#fff}
button:disabled{background:#aaa}

.status{
  background:#e3f2fd;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  font-size:0.95em;
}
.stats{
  background:#f1f8e9;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
  font-size:0.9em;
}
.stats div{margin:4px 0}

pre{
  background:#111;
  color:#0f0;
  padding:10px;
  border-radius:10px;
  height:200px;
  overflow:auto;
  font-size:12px;
}
.footer{
  text-align:center;
  font-size:0.8em;
  color:#666;
  margin-top:10px;
}

#telegram-preview iframe{
  width:100% !important;
}

details {
  margin-top:10px;
  border-top:1px dashed #ddd;
  padding-top:6px;
}
summary {
  cursor:pointer;
  font-weight:600;
}
summary::marker {
  color:#2196F3;
}
details p, details ol {
  margin:6px 0 6px 14px;
  font-size:0.9em;
}
.btn-row{
  display:flex;
  gap:10px;
}

.btn-row button{
  width:auto;      /* ‚¨ÖÔ∏è override width:100% */
  flex:1;          /* lebar sama */
  margin:8px 0;    /* tetap rapi */
}
/* Baris input */
.input-row{
  display:flex;
  gap:10px;
  align-items:center;
}

/* Sembunyikan input file asli */
#fileInput{
  display:none;
}

/* Tombol file custom */
.file-btn{
  padding:10px 14px;
  border-radius:10px;
  background:#e0e0e0;
  cursor:pointer;
  font-weight:600;
  white-space:nowrap;
}

/* Magnet ambil sisa ruang */
#magnet{
  flex:1;
  min-width:0;
}

/* Mobile */
@media (max-width:520px){
  .input-row{
    flex-direction:column;
    align-items:stretch;
  }
}



</style>
</head>
<body>

<h2>üì§ WebTorrent P2P Share</h2>

<div class="status">
Aplikasi web peer-to-peer berbasis <strong>WebTorrent</strong> untuk berbagi file langsung dari browser ke browser secara <strong>real-time</strong>.
</div>

<div class="input-row">
  <label class="file-btn" for="fileInput">
    üìÅ Choose File
  </label>

  <input type="file" id="fileInput" onchange="autoSeed()">

  <input
    type="text"
    id="magnet"
    placeholder="Tempel magnet / hash (BTIH)"
    spellcheck="false"
    autocomplete="off"
  >
</div>



<div class="status" id="hashInfo" style="display:none">
  üîë Torrent ID:
  <code id="hashOnly"></code>
</div>

<div class="btn-row">
  <button class="btn-edit" id="shareBtn" onclick="shareMagnet()" disabled>
    üì£ Share Torrent
  </button>

  <button class="btn-copy" id="copyBtn" onclick="copyMagnet()" disabled>
    üìã Salin ID
  </button>
</div>


<button class="btn-download" onclick="download()">‚¨áÔ∏è Download </button>

<!-- PREVIEW TELEGRAM -->
<div class="status">
‚≠ê Disponsori oleh <strong>Kios MadGazan</strong>
</div>

<div id="telegram-preview"
     style="
       background:#fff;
       border-radius:10px;
       padding:8px;
       border:1px dashed #ccc;
       margin-top:8px;
     ">
</div>

<div id="info" class="status">‚ÑπÔ∏è Belum ada aktivitas</div>

<div class="stats">
  <strong>üìä Status Torrent</strong>
  <div>üü¢ Mode: <span id="seedStatus">Tidak aktif</span></div>
  <div>üë• Peer: <span id="peerCount">0</span></div>
  <div>‚¨áÔ∏è Download: <span id="downloaded">0 B</span></div>
  <div>‚ö° Download speed: <span id="downSpeed">0 B/s</span></div>
  <div>üì¶ File: <span id="fileCount">0</span></div>
  <div>‚¨ÜÔ∏è Upload total: <span id="uploaded">0 B</span></div>
  <div>‚ö° Upload speed: <span id="upSpeed">0 B/s</span></div>
</div>

<pre id="log"></pre>

<!-- FAQ ACCORDION -->
<div class="status" style="background:#ffffff;border:1px solid #ddd;margin-top:16px">
  <strong>‚ùì FAQ ‚Äì Panduan Penggunaan</strong>

  <details open>
    <summary>Ini website apa sih?</summary>
    <p>
      Ini adalah halaman web untuk berbagi file langsung dari browser ke browser
      tanpa upload ke server atau cloud.
    </p>
  </details>

  <details>
    <summary>Apakah saya harus install aplikasi?</summary>
    <p>
      Tidak perlu. Cukup buka halaman ini lewat browser seperti Chrome,
      Edge, Firefox, atau Safari.
    </p>
  </details>

  <details>
    <summary>File saya di-upload ke mana?</summary>
    <p>
      File tidak di-upload ke server mana pun.
      File tetap berada di perangkat kamu dan dibagikan langsung ke user lain.
    </p>
  </details>

  <details>
    <summary>Apa itu Magnet?</summary>
    <p>
      Magnet adalah kode link yang digunakan untuk menemukan file.
      Bentuknya seperti <code>magnet:?xt=urn:btih...</code>.
    </p>
  </details>

  <details>
    <summary>Bagaimana cara upload / share file?</summary>
    <ol>
      <li>Pilih file</li>
      <li>Klik <b>üå± Mulai Seeding</b></li>
      <li>Tunggu magnet muncul</li>
      <li>Klik <b>Share Magnet</b></li>
    </ol>
    <p>
      Jangan tutup tab browser agar file tetap bisa didownload.
    </p>
  </details>

  <details>
    <summary>Bagaimana cara download file?</summary>
    <ol>
      <li>Salin magnet dari Telegram</li>
      <li>Tempel ke kolom Magnet</li>
      <li>Klik <b>‚¨áÔ∏è Download</b></li>
    </ol>
    <p>
      File akan otomatis tersimpan setelah download selesai.
    </p>
  </details>

  <details>
    <summary>Kenapa download saya tidak jalan?</summary>
    <p>
      Biasanya karena tidak ada seeder yang online
      atau uploader sudah menutup halaman browser.
    </p>
  </details>

  <details>
    <summary>Apakah aman?</summary>
    <p>
      Aman. Tidak ada login, tidak ada akun, dan tidak ada server penyimpan file.
    </p>
  </details>

  <details>
    <summary>Kenapa harus tetap buka tab browser?</summary>
    <p>
      Karena browser kamu berfungsi sebagai seeder.
      Jika tab ditutup, file tidak bisa diakses user lain.
    </p>
  </details>

  <details>
    <summary>Saya pakai HP, kok paste susah?</summary>
    <p>
      Ini normal, terutama di iPhone.
      Tekan & tahan magnet ‚Üí Salin ‚Üí Tempel ke kolom magnet.
    </p>
  </details>

  <details>
    <summary>Apakah file besar aman?</summary>
    <p>
      Aman, tapi pastikan koneksi stabil dan jangan menutup browser saat proses berjalan.
    </p>
  </details>

  <details>
    <summary>Kalau saya download, apakah ikut upload?</summary>
    <p>
      Ya. Setelah download selesai, kamu otomatis ikut menjadi seeder
      dan membantu user lain.
    </p>
  </details>

  <details>
    <summary>Kenapa ada preview Telegram?</summary>
    <p>
      Untuk memudahkan melihat dan menyalin magnet terbaru
      langsung dari channel Telegram.
    </p>
  </details>

  <details>
    <summary>Apakah ini legal?</summary>
    <p>
      Teknologinya legal.
      Isi file dan penggunaannya menjadi tanggung jawab masing-masing user.
    </p>
  </details>
  
  <details>
  <summary>Bolehkah saya menutup halaman ini?</summary>
  <p>
    Jika kamu adalah uploader (seeder), jangan tutup halaman ini.
    Jika kamu hanya download dan sudah selesai, boleh ditutup.
  </p>
</details>

</div>

<div class="footer">
Browser Torrent ¬∑ Selama tab terbuka, kamu adalah seeder üå±
</div>

<script>
/* ======================
   KONFIGURASI TELEGRAM
====================== */
const TOKEN = "8384730708:AAHjPCLYpW7wz2B5-jBxMJ17-kH1G1zXZuY";
const CHAT_ID = -1001538855794;
const MESSAGE_ID = 27;
const CHANNEL_USERNAME = "promoteauto"; // TANPA @

/* ======================
   WEBTORRENT
====================== */
const TORRENT_TRACKERS = [
  "wss://tracker.openwebtorrent.com",
  "wss://tracker.btorrent.xyz",
  "udp://tracker.opentrackr.org:1337",
  "udp://explodie.org:6969"
];

const client = new WebTorrent();
let currentTorrent = null;
let uploadedBytes = 0;

const log = msg => {
  const p = document.getElementById("log");
  p.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  p.scrollTop = p.scrollHeight;
};

function format(bytes){
  if(bytes > 1024*1024) return (bytes/1024/1024).toFixed(2)+" MB";
  if(bytes > 1024) return (bytes/1024).toFixed(1)+" KB";
  return bytes+" B";
}

function extractHash(input){
  if(!input) return null;

  const m = input.match(/btih:([a-f0-9]{40})/i);
  if(m) return m[1];

  if(/^[a-f0-9]{40}$/i.test(input))
    return input;

  return null;
}


function buildMagnet(hash, name){
  let m = `magnet:?xt=urn:btih:${hash}`;

  if(name){
    m += `&dn=${encodeURIComponent(name)}`;
  }

  TORRENT_TRACKERS.forEach(tr => {
    m += `&tr=${encodeURIComponent(tr)}`;
  });

  return m;
}


/* ======================
   COPY MAGNET
====================== */
function copyMagnet(){
  const input = document.getElementById("magnet").value.trim();
  const hash = extractHash(input);
  if(!hash) return;

  const text = `magnet:?xt=urn:btih:${hash}`;

  navigator.clipboard.writeText(text);
  log("üìã Torrent ID disalin");
  document.getElementById("info").textContent =
    "üìã Torrent ID disalin";
}



/* ======================
   PASTE MAGNET (FIX)
====================== */
async function pasteMagnet(){
  try{
    const text = await navigator.clipboard.readText();

    if(!text){
      alert("Clipboard kosong");
      return;
    }

    if(!text.trim().startsWith("magnet:?")){
      alert("Isi clipboard bukan magnet URI");
      return;
    }

    const input = document.getElementById("magnet");
    input.value = text.trim();
    input.focus();

    log("üì• Magnet dipaste ke kolom");
    document.getElementById("info").textContent =
      "üì• Magnet dipaste ke kolom magnet";

  }catch(err){
    alert("Gagal paste. Pastikan HTTPS & izin clipboard.");
  }
}

function autoSeed(){
  const input = document.getElementById("fileInput");
  if(!input.files.length) return;

  // üî¥ HENTIKAN TORRENT SEBELUMNYA
  if(currentTorrent){
    currentTorrent.destroy();
    currentTorrent = null;
    log("‚ôªÔ∏è Torrent sebelumnya dihentikan");
  }

  const file = input.files[0];
  uploadedBytes = 0;

  document.getElementById("info").textContent = "üå± Membuat torrent...";
  log("üìÅ File dipilih: " + file.name);

  client.seed(file, torrent=>{
    currentTorrent = torrent;

    const hash = torrent.infoHash;

	document.getElementById("magnet").value =
  `magnet:?xt=urn:btih:${hash}`;

	document.getElementById("hashOnly").textContent = hash;
	document.getElementById("hashInfo").style.display = "block";

    document.getElementById("copyBtn").disabled = false;
    document.getElementById("shareBtn").disabled = false;

    document.getElementById("seedStatus").textContent =
      "AKTIF (Seeder)";
    document.getElementById("fileCount").textContent =
      torrent.files.length;

    document.getElementById("info").textContent =
      "üß≤ Magnet siap & seeding aktif";

    log("üß≤ Magnet siap");
    log("üå± Seeding otomatis dimulai");

    bindSeederStats(torrent);
  });
}


/* ======================
   SEED FILE
====================== */
/*function seedFile(){
  const input = document.getElementById("fileInput");
  if(!input.files.length){
    alert("Pilih file dulu");
    return;
  }

  const file = input.files[0];
  uploadedBytes = 0;

  document.getElementById("info").textContent = "üå± Membuat torrent...";
  log("üìÅ File: "+file.name);

  client.seed(file, torrent=>{
    currentTorrent = torrent;
    document.getElementById("magnet").value = torrent.magnetURI;
    document.getElementById("copyBtn").disabled = false;
    document.getElementById("shareBtn").disabled = false;

    document.getElementById("seedStatus").textContent = "AKTIF (Seeder)";
    document.getElementById("fileCount").textContent = torrent.files.length;

    log("üß≤ Magnet siap");
    log("üå± Seeding dimulai");

    bindSeederStats(torrent);
  });
}*/

/* ======================
   DOWNLOAD ‚Üí AUTO SEED
====================== */
function download(){
  const input = document.getElementById("magnet").value.trim();
  const hash = extractHash(input);

  if(!hash){
    alert("Masukkan magnet atau hash yang valid");
    return;
  }

  const magnet = buildMagnet(hash);

  client.add(magnet, torrent=>{
    currentTorrent = torrent;
    uploadedBytes = 0;

    /* ‚úÖ SET STATUS AWAL DOWNLOAD */
    document.getElementById("info").textContent =
      "‚¨áÔ∏è Download dimulai";
    document.getElementById("seedStatus").textContent =
      "‚¨áÔ∏è Downloading";
    document.getElementById("uploaded").textContent = "0 B";
    document.getElementById("upSpeed").textContent = "0 B/s";

    log("‚¨áÔ∏è Download dimulai");

    /* ‚úÖ UPDATE STATUS SETIAP DATA MASUK */
    torrent.on("download", ()=>{
      const p = Math.round(torrent.progress * 100);

      document.getElementById("info").textContent =
        `‚¨áÔ∏è Download ${p}%`;

      document.getElementById("peerCount").textContent =
        torrent.numPeers;

      document.getElementById("downloaded").textContent =
        format(torrent.downloaded);

      document.getElementById("downSpeed").textContent =
        format(torrent.downloadSpeed) + "/s";
    });

    /* ‚úÖ SETELAH DOWNLOAD SELESAI */
    torrent.on("done", ()=>{
      log("‚úÖ Download selesai");
      log("üíæ Menyimpan file...");

      document.getElementById("info").textContent =
        "üíæ Menyimpan file ke browser...";

      document.getElementById("seedStatus").textContent =
        "AKTIF (Seeder)";
      document.getElementById("fileCount").textContent =
        torrent.files.length;

      torrent.files.forEach(file=>{
        file.getBlob((err, blob)=>{
          if(err){
            log("‚ùå Gagal simpan: " + file.name);
            return;
          }

          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = file.name;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          log("üíæ File tersimpan: " + file.name);
        });
      });

      /* ‚úÖ BARU AKTIFKAN STAT SEEDER */
      bindSeederStats(torrent);
    });
  });
}


/* ======================
   SEEDER STATS
====================== */
function bindSeederStats(torrent){
  torrent.on("wire", ()=>{
    document.getElementById("peerCount").textContent =
      torrent.numPeers;
  });

  torrent.on("upload", bytes=>{
    uploadedBytes += bytes;
    document.getElementById("uploaded").textContent =
      format(uploadedBytes);
    document.getElementById("upSpeed").textContent =
      format(torrent.uploadSpeed)+"/s";
  });
}

/* ======================
   TELEGRAM EMBED
====================== */
function loadTelegramPreview(){
  const box = document.getElementById("telegram-preview");
  box.innerHTML = "";

  const s = document.createElement("script");
  s.src = "https://telegram.org/js/telegram-widget.js?22";
  s.async = true;
  s.setAttribute(
    "data-telegram-post",
    `${CHANNEL_USERNAME}/${MESSAGE_ID}`
  );
  s.setAttribute("data-width", "100%");
  s.setAttribute("data-userpic", "false");

  box.appendChild(s);
}

loadTelegramPreview();

/* ======================
   EDIT PESAN TELEGRAM
====================== */
async function shareMagnet(){
  const magnet = document.getElementById("magnet").value.trim();
  if(!magnet) return;

  const hash = extractHash(magnet);

  const text = `${hash}
`;


  document.getElementById("info").textContent =
    "‚úèÔ∏è Mengedit pesan Telegram...";

  try{
    await fetch(
      `https://api.telegram.org/bot${TOKEN}/editMessageText`,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          chat_id: CHAT_ID,
          message_id: MESSAGE_ID,
          text: text,
          disable_web_page_preview: true
        })
      }
    );

    log("‚úèÔ∏è Pesan Telegram diperbarui");
    document.getElementById("info").textContent =
      "‚úÖ Pesan Telegram diperbarui";

    loadTelegramPreview();

  }catch(err){
    document.getElementById("info").textContent =
      "‚ùå Error: " + err.message;
  }
}

function openInstantPopup(){
  const magnet = document.getElementById("magnet").value.trim()
  if(!magnet){
    alert("Magnet belum tersedia")
    return
  }

  // Ambil info hash
  const m = magnet.match(/btih:([a-fA-F0-9]+)/)
  if(!m){
    alert("Magnet tidak valid")
    return
  }

  const hash = m[1]
  const url = "https://instant.io/#" + hash

  // Popup kecil
  const w = 520
  const h = 600
  const x = (screen.width - w) / 2
  const y = (screen.height - h) / 2

  window.open(
    url,
    "instantio",
    `width=${w},height=${h},left=${x},top=${y},resizable=yes,scrollbars=yes`
  )
}
</script>

<div style="text-align:center;margin-top:16px">
  <button
    onclick="openInstantPopup()"
    style="
      background:#000;
      color:#fff;
      padding:12px 18px;
      border-radius:10px;
      font-size:1em;
      cursor:pointer;
    ">
    ‚ö° Buka di Instant.io
  </button>
</div>


</body>
</html>
