<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini WebTorrent P2P</title>
<script src="https://cdn.jsdelivr.net/npm/webtorrent@0.115.0/webtorrent.min.js"></script>

<style>
</style>
</head>
<body>
<center>
<h2>Mini WebTorrent P2P Stabil</h2>

<!-- SEEDING -->
<input type="file" id="fileInput" multiple>
<p id="seedInfo"></p>
<button id="copyMagnetBtn">Copy Magnet</button>

<!-- DOWNLOAD -->
<input type="text" id="magnetInput" placeholder="Masukkan magnet / hash" size="60">
<button id="downloadBtn" disabled>Download</button>
<p id="downloadInfo"></p>
<p id="peerInfo"></p>
</center>
<script>
const client = new WebTorrent();
let currentTorrent = null;
let downloadTorrent = null;

function info(id, text) {
  document.getElementById(id).textContent = text;
}

// ================== SEED FILE (MULTI) ==================
document.getElementById('fileInput').addEventListener('change', e => {
  const files = Array.from(e.target.files);
  if (!files.length) return;

  if (currentTorrent) currentTorrent.destroy();

  client.seed(files, torrent => {
    currentTorrent = torrent;
    info('seedInfo', `ðŸŒ± Seeding ${files.length} file aktif!`);
    console.log('Magnet link:', torrent.magnetURI);
  });
});

// ================== COPY MAGNET ==================
document.getElementById('copyMagnetBtn').addEventListener('click', () => {
  if (!currentTorrent) {
    info('seedInfo', 'Belum ada torrent yang diseed');
    return;
  }
  navigator.clipboard.writeText(currentTorrent.magnetURI);
  info('seedInfo', 'ðŸŒ± Magnet link disalin ke clipboard');
});

// ================== DOWNLOAD ==================
document.getElementById('downloadBtn').addEventListener('click', () => {
  const magnet = document.getElementById('magnetInput').value.trim();
  if (!magnet) return alert('Masukkan magnet / hash dulu!');

  downloadTorrent = client.add(magnet, torrent => {
    info('downloadInfo', 'â¬‡ï¸ Download dimulai...');

    torrent.on('download', () => {
      const percent = ((torrent.downloaded / torrent.length) * 100).toFixed(2);
      info('downloadInfo', `â¬‡ï¸ Download: ${percent}%`);
      info('peerInfo', `Peers: ${torrent.numPeers}`);
    });

    torrent.on('done', () => {
      info('downloadInfo', 'Download selesai!');
      torrent.files.forEach(file => {
        file.getBlob((err, blob) => {
          if (!err) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = file.name;
            a.click();
          }
        });
      });
    });
  });
});

// ================== ENABLE DOWNLOAD ==================
document.getElementById('magnetInput').addEventListener('input', () => {
  document.getElementById('downloadBtn').disabled =
    !document.getElementById('magnetInput').value.trim();
});

client.on('error', err => console.error('WebTorrent Error:', err));
</script>


</body>
</html>
