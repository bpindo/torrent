<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Realtime Log P2P (A-B-C)</title>
<style>
body { font-family: monospace; background:#111; color:#0f0; padding:15px }
textarea { width:100%; background:#000; color:#0f0; border:1px solid #0f0 }
button { margin:5px 0; padding:6px 12px }
pre { background:#000; padding:10px; height:250px; overflow:auto }
.box { border:1px solid #0f0; padding:10px; margin-bottom:10px }
</style>
</head>
<body>

<h2>üåê Realtime Log Viewer (A / B / C / dst)</h2>

<div class="box">
<b>1Ô∏è‚É£ Mode</b><br>
<button onclick="start(true)">Start sebagai Initiator (A)</button>
<button onclick="start(false)">Start sebagai Receiver (B/C)</button>
</div>

<div class="box">
<b>2Ô∏è‚É£ Signaling</b>
<textarea id="signal" placeholder="Copy / Paste signal di sini"></textarea>
<button onclick="applySignal()">Apply Signal</button>
</div>

<div class="box">
<b>3Ô∏è‚É£ Kirim Log</b>
<textarea id="logInput" placeholder="Tulis log..."></textarea>
<button onclick="sendLog()">Kirim</button>
</div>

<div class="box">
<b>üì° Log Realtime</b>
<pre id="logs"></pre>
</div>

<script src="https://cdn.jsdelivr.net/npm/simple-peer@9/simplepeer.min.js"></script>
<script>
let peer

function start(initiator) {
  peer = new SimplePeer({
    initiator,
    trickle: false
  })

  peer.on('signal', data => {
    document.getElementById('signal').value =
      JSON.stringify(data, null, 2)
  })

  peer.on('connect', () => {
    logSys("‚úÖ CONNECTED")
  })

  peer.on('data', data => {
    const msg = JSON.parse(data)
    log(`[${msg.time}] ${msg.from}: ${msg.text}`)
  })

  logSys("‚è≥ Peer dibuat (" + (initiator ? "Initiator" : "Receiver") + ")")
}

function applySignal() {
  peer.signal(JSON.parse(document.getElementById('signal').value))
}

function sendLog() {
  if (!peer || !peer.connected) return
  const text = document.getElementById('logInput').value
  peer.send(JSON.stringify({
    from: "User",
    time: new Date().toLocaleTimeString(),
    text
  }))
  document.getElementById('logInput').value = ""
}

function log(msg) {
  const el = document.getElementById('logs')
  el.textContent += msg + "\n"
  el.scrollTop = el.scrollHeight
}

function logSys(msg) {
  log("### " + msg)
}
</script>

</body>
</html>