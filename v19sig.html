<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebRTC + WebTorrent P2P</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
<style>
body {
  font-family: monospace;
  background:#111;
  color:#0f0;
  padding:15px;
}
textarea, input, button {
  width:100%;
  background:#000;
  color:#0f0;
  border:1px solid #0f0;
  padding:5px;
  margin:4px 0;
}
#log {
  height:220px;
  overflow:auto;
  border:1px solid #0f0;
  padding:5px;
}
</style>
</head>
<body>

<h3>ðŸ”— WebRTC + WebTorrent (Pure HTML)</h3>

<button onclick="createOffer()">Create Offer</button>
<textarea id="offer" placeholder="Offer"></textarea>

<button onclick="createAnswer()">Create Answer</button>
<textarea id="answer" placeholder="Answer"></textarea>

<button onclick="setAnswer()">Set Answer</button>

<hr>

<div id="log"></div>

<input id="msg" placeholder="Ketik chat / magnet link">
<button onclick="send()">Send</button>

<script>
const pc = new RTCPeerConnection();
let channel;
const logBox = document.getElementById("log");

const client = new WebTorrent();

function log(txt){
  logBox.innerHTML += txt + "<br>";
  logBox.scrollTop = logBox.scrollHeight;
}

pc.ondatachannel = e => {
  channel = e.channel;
  setupChannel();
};

function setupChannel(){
  channel.onopen = ()=>log("âœ… WebRTC connected");
  channel.onmessage = e => {
    log("Peer: " + e.data);
    if(e.data.startsWith("magnet:")){
      startTorrent(e.data);
    }
  };
}

async function createOffer(){
  channel = pc.createDataChannel("chat");
  setupChannel();
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  offerBox.value = JSON.stringify(offer);
}

async function createAnswer(){
  const offer = JSON.parse(offerBox.value);
  await pc.setRemoteDescription(offer);
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  answerBox.value = JSON.stringify(answer);
}

async function setAnswer(){
  const answer = JSON.parse(answerBox.value);
  await pc.setRemoteDescription(answer);
}

function send(){
  const text = msg.value;
  channel.send(text);
  log("Me: " + text);
  msg.value = "";
}

function startTorrent(magnet){
  log("â¬‡ï¸ Start torrent...");
  client.add(magnet, torrent => {
    log("ðŸ“ " + torrent.name);
    torrent.on('download', () => {
      log("â¬‡ï¸ " + (torrent.progress*100).toFixed(1) + "%");
    });
    torrent.files.forEach(file => {
      file.appendTo(document.body);
    });
  });
}

const offerBox = document.getElementById("offer");
const answerBox = document.getElementById("answer");
const msg = document.getElementById("msg");
</script>

</body>
</html>